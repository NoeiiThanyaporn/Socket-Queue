<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Socket.IO Queue</title>
  <style>
    body {
      margin: 0;
      padding-bottom: 3rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    #messages {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    #messages>li {
      padding: 0.5rem 1rem;
    }

    #messages>li:nth-child(odd) {
      background: #efefef;
    }
  </style>
</head>

<body>
  <ul id="messages"></ul>
  <form id="form" action="">
    <button id="toggle-btn">Submit / Leave</button>
  </form>
  <div id="live-stats">
    <p><strong>Using:</strong> <span id="using-count">0</span></p>
    <p><strong>Queue:</strong> <span id="queue-count">0</span></p>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const toggleButton = document.getElementById('toggle-btn');

    socket.on('in_using', (data) => {
      const messages = document.getElementById('messages');
      const container = document.createElement('li');

      messages.innerHTML = '';
      const status = document.createElement('div');
      status.textContent = "✅ You can use the site";
      status.style.fontSize = "1.5rem";

      const subtext = document.createElement('div');
      subtext.textContent = `Total accessed: ${data.number} / 5`;
      subtext.style.fontSize = "0.9rem";

      container.appendChild(status);
      container.appendChild(subtext);
      messages.appendChild(container);
    });

    socket.on('in_queue', (data) => {
      const messages = document.getElementById('messages');
      const container = document.createElement('li');
      messages.innerHTML = '';

      const status = document.createElement('div');
      status.textContent = "⏳ Waiting queue";
      status.style.fontSize = "1.5rem";

      const subtext = document.createElement('div');
      subtext.textContent = `Position in queue: ${data.number}`;
      subtext.style.fontSize = "0.9rem";
      subtext.style.color = "#555";

      container.appendChild(status);
      container.appendChild(subtext);
      messages.appendChild(container);
    });


    // Button connet-disconnect
    toggleButton.addEventListener('click', (e) => {
      e.preventDefault();
      if (socket.connected) {
        toggleButton.innerText = 'Entry';
        socket.disconnect();
      } else {
        toggleButton.innerText = 'Submit / Leave';
        socket.connect();
      }
    });

    socket.on('update_status', (data) => {
      console.log("Active:", data.active, data.active.length);
      console.log("Queue:", data.queue, data.queue.length);

      document.getElementById('using-count').textContent = data.active.length;
      document.getElementById('queue-count').textContent = data.queue.length;
    });

  </script>
</body>

</html>